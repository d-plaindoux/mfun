<!doctype html>
<html lang="fr">
<head>
    <script type="application/javascript" src="../dist/mFun.min.js"></script>

    <script type="application/mfun">
    def setDom { n v     -> native "set"   }
    def getDom { n       -> native "get"   }

    def leq    { l r t f -> native "leq"   }
    def plus   { l r     -> native "plus" }
    def mult   { l r     -> native "mult"  }
    def minus  { l r     -> native "minus" }
    </script>

    <script type="application/mfun">
    def changeDom { n v -> do { setDom (getDom n) v } yield { v } }

    def cond   { c t f -> c t f () }

    def do    { f   -> then () f }
    def then  { v f -> { v c -> c v } $ f v }
    def yield { v f  -> f v }
    </script>

    <script type="application/mfun">
    def fact { a ->
        cond (leq a 1)
             { 1 }
             { mult a $ fact $ minus a 1 }
    }
    </script>

    <script type="application/javascript">
        function evalPrint(sourceCode) {
            console.log("Executing [" + sourceCode + "]");
            mFun.default.eval_print(sourceCode);
        }

        function execute() {
            mFun.default.reader.browser(evalPrint);
        }
    </script>

</head>
<body>
  <div onclick="execute()">
    <pre>fact &lt;i id='val'><i class="tk" id='val'>?</i>&lt;/i> = &lt;i id='res'><i class="tk" id='res'>?</i>&lt/i></pre>
  </div>
  
  <script type="application/mfun">
    def compute_then_display { v ->
        do    { changeDom "val" v }
        then  { changeDom "res" $ fact v }
        yield { () }
    }

    compute_then_display 100

  </script>
</body>
</html>
